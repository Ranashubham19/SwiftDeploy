# Railway configuration file

[build]
builder = "NIXPACKS"

[build.nixpacks]
phases = {
  "install": {
    "cmds": ["npm install", "cd backend && npm install"]
  },
  "build": {
    "cmds": ["cd backend && npm run build"]
  }
}
artifacts = ["backend/dist"]

[variables]
TELEGRAM_BOT_TOKEN = { required = true, description = "Telegram Bot Token from @BotFather" }
GOOGLE_CLIENT_ID = { required = true, description = "Google OAuth Client ID" }
GOOGLE_CLIENT_SECRET = { required = true, description = "Google OAuth Client Secret" }
SESSION_SECRET = { required = true, description = "Session secret for express-session" }
API_KEY = { required = true, description = "Gemini API Key" }

[deploy]
startCommand = "node --import ./backend/env-preload.mjs backend/dist/server.js"
healthcheckPath = "/health"
healthcheckTimeout = 300
numReplicas = 1
region = "us-east1"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3
