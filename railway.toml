# Railway configuration file

[build]
builder = "NIXPACKS"

[build.nixpacks]
phases = {
  "install": {
    "cmds": ["npm install", "cd backend && npm install"]
  },
  "build": {
    "cmds": ["cd backend && npm run build"]
  }
}
artifacts = ["backend/dist"]

[variables]
TELEGRAM_BOT_TOKEN = { required = true, description = "Telegram Bot Token from @BotFather" }
GOOGLE_CLIENT_ID = { required = true, description = "Google OAuth Client ID" }
GOOGLE_CLIENT_SECRET = { required = true, description = "Google OAuth Client Secret" }
SESSION_SECRET = { required = true, description = "Session secret for express-session" }
AI_PROVIDER = { required = false, description = "Primary AI provider (sarvam/openrouter/openai/anthropic/gemini)" }
SARVAM_API_KEYS = { required = false, description = "Comma-separated Sarvam API keys for primary routing" }
SARVAM_MODEL = { required = false, description = "Sarvam model identifier (default: sarvam-m)" }
SARVAM_BASE_URL = { required = false, description = "Sarvam chat completions endpoint URL" }
API_KEY = { required = false, description = "Gemini API key (optional fallback)" }

[deploy]
startCommand = "node --import ./backend/env-preload.mjs backend/dist/server.js"
healthcheckPath = "/health"
healthcheckTimeout = 300
numReplicas = 1
region = "us-east1"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3
